{
  "specialist": "benchmark",
  "domain": "hospitality",
  "cells": [
    {
      "cell_type": "markdown",
      "content": "# 서울 에어비앤비 RevPAR 벤치마크 비교 분석\n\n**분석 목적:** 서울 25개 자치구 및 호스트 특성별 RevPAR(Revenue Per Available Room) 성과를 전체 시장 기준선과 비교하여 상대적 위치를 파악하고, 수익 최적화 전략 수립에 필요한 인사이트를 도출합니다.\n\n**업계 벤치마크:**\n- 전체(All listings) 중위 RevPAR: ₩8,868\n- Active + Operating 중위 RevPAR: ₩47,850\n\n**분석 항목:**\n1. 자치구별 RevPAR vs 서울 전체 기준선\n2. room_type별 RevPAR vs 서울 전체 기준선\n3. Superhost vs 일반 호스트 RevPAR 비교 (구별 상관관계 포함)\n4. POI 거리 구간별 RevPAR 비교\n5. 점유율 구간별 RevPAR 분포"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 공통 설정: 라이브러리 임포트, 데이터 로드, 기준선 정의\n# ============================================================\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as mticker\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# 한글 폰트 설정 (macOS)\nplt.rc('font', family='AppleGothic')\nplt.rcParams['axes.unicode_minus'] = False  # 마이너스 부호 깨짐 방지\n\n# ── 데이터 로드 ──────────────────────────────────────────────\nDATA_PATH = '/Users/jungmo/Documents/data-projects/seoul_airbnb_cleaned_2026-02-18_11-23/data/raw/seoul_airbnb_cleaned.csv'\ndf_bm_raw = pd.read_csv(DATA_PATH)\nprint(f'데이터 로드 완료: {df_bm_raw.shape[0]:,}행 × {df_bm_raw.shape[1]}열')\n\n# ── 업계 벤치마크 기준선 정의 ───────────────────────────────\ndf_bm_BASELINE_ALL    = 8_868    # 전체 리스팅 중위 RevPAR (₩)\ndf_bm_BASELINE_ACTIVE = 47_850   # Active+Operating 중위 RevPAR (₩)\n\n# ── 실제 데이터 기반 기준선 계산 ────────────────────────────\ndf_bm_median_all    = df_bm_raw['ttm_revpar'].median()          # 전체 중위값\ndf_bm_median_active = (                                          # Active+Operating 중위값\n    df_bm_raw.query(\"refined_status == 'Active' and operation_status == 'Operating'\")\n    ['ttm_revpar'].median()\n)\nprint(f'전체 중위 RevPAR    : ₩{df_bm_median_all:,.0f}  (벤치마크 ₩{df_bm_BASELINE_ALL:,})')\nprint(f'Active+Oper 중위 RevPAR: ₩{df_bm_median_active:,.0f}  (벤치마크 ₩{df_bm_BASELINE_ACTIVE:,})')\n\n# ── 자치구 한글 매핑 ─────────────────────────────────────────\ndf_bm_district_kr = {\n    'Gangnam-gu':      '강남구',\n    'Gangdong-gu':     '강동구',\n    'Gangbuk-gu':      '강북구',\n    'Gangseo-gu':      '강서구',\n    'Gwanak-gu':       '관악구',\n    'Gwangjin-gu':     '광진구',\n    'Guro-gu':         '구로구',\n    'Geumcheon-gu':    '금천구',\n    'Nowon-gu':        '노원구',\n    'Dobong-gu':       '도봉구',\n    'Dongdaemun-gu':   '동대문구',\n    'Dongjak-gu':      '동작구',\n    'Mapo-gu':         '마포구',\n    'Seodaemun-gu':    '서대문구',\n    'Seocho-gu':       '서초구',\n    'Seongdong-gu':    '성동구',\n    'Seongbuk-gu':     '성북구',\n    'Songpa-gu':       '송파구',\n    'Yangcheon-gu':    '양천구',\n    'Yeongdeungpo-gu': '영등포구',\n    'Yongsan-gu':      '용산구',\n    'Eunpyeong-gu':    '은평구',\n    'Jongno-gu':       '종로구',\n    'Jung-gu':         '중구',\n    'Jungnang-gu':     '중랑구',\n}\ndf_bm_raw['district_kr'] = df_bm_raw['district'].map(df_bm_district_kr)\n\nprint('\\n공통 설정 완료.')"
    },
    {
      "cell_type": "markdown",
      "content": "## 1. 자치구별 RevPAR vs 서울 전체 기준선\n\n**분석 목적:** 서울 25개 자치구의 중위 RevPAR를 전체 시장 기준선(₩8,868)과 비교하여, 고성과 지역과 저성과 지역을 식별합니다.\n\n**해석 방향:**\n- 기준선 이상 구는 시장 평균 대비 우위 → 프리미엄 전략 가능 지역\n- 기준선 미만 구는 점유율 또는 단가 개선이 필요한 지역"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 1. 자치구별 RevPAR vs 서울 전체 기준선\n# ============================================================\n\n# ── 자치구별 중위 RevPAR 집계 ────────────────────────────────\ndf_bm_district_revpar = (\n    df_bm_raw.groupby(['district', 'district_kr'])['ttm_revpar']\n    .agg(median='median', mean='mean', count='count')\n    .reset_index()\n    .sort_values('median', ascending=True)   # 가로 막대 시각화용 오름차순\n)\n\n# ── 기준선 대비 색상 구분 (초과 → 주황/강조, 미만 → 회색) ───\ndf_bm_district_revpar['color'] = df_bm_district_revpar['median'].apply(\n    lambda x: '#E84545' if x >= df_bm_BASELINE_ACTIVE else\n              '#F4A261' if x >= df_bm_BASELINE_ALL else\n              '#ADB5BD'\n)\n\n# ── 시각화 ──────────────────────────────────────────────────\nfig, ax = plt.subplots(figsize=(14, 8))\n\nbars = ax.barh(\n    df_bm_district_revpar['district_kr'],\n    df_bm_district_revpar['median'],\n    color=df_bm_district_revpar['color'],\n    edgecolor='white',\n    height=0.7\n)\n\n# 전체 중위 기준선\nax.axvline(\n    x=df_bm_BASELINE_ALL,\n    color='#2196F3',\n    linestyle='--',\n    linewidth=1.8,\n    label=f'전체 중위 기준선 ₩{df_bm_BASELINE_ALL:,}'\n)\n\n# Active+Operating 기준선\nax.axvline(\n    x=df_bm_BASELINE_ACTIVE,\n    color='#E91E63',\n    linestyle='-.',\n    linewidth=1.8,\n    label=f'Active+Operating 기준선 ₩{df_bm_BASELINE_ACTIVE:,}'\n)\n\n# 막대 우측에 수치 레이블\nfor bar, val in zip(bars, df_bm_district_revpar['median']):\n    ax.text(\n        val + 300,\n        bar.get_y() + bar.get_height() / 2,\n        f'₩{val:,.0f}',\n        va='center',\n        ha='left',\n        fontsize=8.5\n    )\n\n# 범례 (색상 의미 설명)\nfrom matplotlib.patches import Patch\nlegend_handles = [\n    Patch(facecolor='#E84545', label=f'Active+Oper 기준선 초과'),\n    Patch(facecolor='#F4A261', label=f'전체 기준선 초과'),\n    Patch(facecolor='#ADB5BD', label='전체 기준선 미만'),\n]\nax.legend(\n    handles=legend_handles + [\n        plt.Line2D([0], [0], color='#2196F3', linestyle='--', linewidth=1.8,\n                   label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}'),\n        plt.Line2D([0], [0], color='#E91E63', linestyle='-.', linewidth=1.8,\n                   label=f'Active+Oper 중위 ₩{df_bm_BASELINE_ACTIVE:,}'),\n    ],\n    loc='lower right',\n    fontsize=9\n)\n\nax.set_xlabel('중위 TTM RevPAR (₩)', fontsize=11)\nax.set_title('서울 25개 자치구별 중위 RevPAR vs 전체 기준선', fontsize=14, fontweight='bold', pad=12)\nax.xaxis.set_major_formatter(mticker.FuncFormatter(lambda x, _: f'₩{x:,.0f}'))\nax.set_xlim(0, df_bm_district_revpar['median'].max() * 1.18)\nax.grid(axis='x', alpha=0.3, linestyle=':')\nplt.tight_layout()\nplt.show()\n\n# ── 수치 요약 출력 ───────────────────────────────────────────\nprint('\\n[상위 5개 자치구]')\nprint(\n    df_bm_district_revpar.sort_values('median', ascending=False)[['district_kr', 'median', 'count']]\n    .head(5)\n    .rename(columns={'district_kr': '자치구', 'median': '중위RevPAR', 'count': '리스팅수'})\n    .to_string(index=False)\n)\nprint('\\n[하위 5개 자치구]')\nprint(\n    df_bm_district_revpar.sort_values('median', ascending=True)[['district_kr', 'median', 'count']]\n    .head(5)\n    .rename(columns={'district_kr': '자치구', 'median': '중위RevPAR', 'count': '리스팅수'})\n    .to_string(index=False)\n)"
    },
    {
      "cell_type": "markdown",
      "content": "## 2. room_type별 RevPAR vs 서울 전체 기준선\n\n**분석 목적:** 숙소 유형(entire_home / private_room / hotel_room / shared_room)별 RevPAR 분포를 전체 기준선과 비교하여, 유형별 수익성 차이를 파악합니다.\n\n**해석 방향:**\n- 중위값이 기준선을 상회하는 유형 → 수요·단가 경쟁력 우위\n- 평균과 중위 격차가 큰 유형 → 극단값(outlier) 왜곡 주의"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 2. room_type별 RevPAR vs 서울 전체 기준선\n# ============================================================\n\n# ── room_type 집계 ───────────────────────────────────────────\ndf_bm_ROOM_TYPE_KR = {\n    'entire_home':   '전체 홈',\n    'private_room':  '개인 룸',\n    'hotel_room':    '호텔 룸',\n    'shared_room':   '공유 룸',\n}\ndf_bm_room_stats = (\n    df_bm_raw.groupby('room_type')['ttm_revpar']\n    .agg(median='median', mean='mean', q25=lambda x: x.quantile(0.25),\n         q75=lambda x: x.quantile(0.75), count='count')\n    .reset_index()\n)\ndf_bm_room_stats['room_type_kr'] = df_bm_room_stats['room_type'].map(df_bm_ROOM_TYPE_KR)\ndf_bm_room_stats = df_bm_room_stats.sort_values('median', ascending=False)\n\n# ── 시각화: 2×2 서브플롯 ─────────────────────────────────────\nfig, axes = plt.subplots(1, 2, figsize=(14, 6))\n\n# (1) 중위/평균 막대 비교\nax = axes[0]\nx     = np.arange(len(df_bm_room_stats))\nwidth = 0.35\n\nbars_med = ax.bar(x - width/2, df_bm_room_stats['median'],\n                  width, label='중위값', color='#4A90D9', alpha=0.85)\nbars_avg = ax.bar(x + width/2, df_bm_room_stats['mean'],\n                  width, label='평균값', color='#F4A261', alpha=0.85)\n\nax.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n           linewidth=1.8, label=f'전체 중위 기준선 ₩{df_bm_BASELINE_ALL:,}')\nax.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n           linewidth=1.8, label=f'Active+Oper 기준선 ₩{df_bm_BASELINE_ACTIVE:,}')\n\n# 막대 상단 레이블\nfor bar in bars_med:\n    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 300,\n            f'₩{bar.get_height():,.0f}', ha='center', va='bottom', fontsize=8)\nfor bar in bars_avg:\n    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 300,\n            f'₩{bar.get_height():,.0f}', ha='center', va='bottom', fontsize=8)\n\nax.set_xticks(x)\nax.set_xticklabels(df_bm_room_stats['room_type_kr'], fontsize=10)\nax.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax.set_title('room_type별 RevPAR 중위·평균 vs 기준선', fontsize=12, fontweight='bold')\nax.legend(fontsize=8.5, loc='upper right')\nax.grid(axis='y', alpha=0.3, linestyle=':')\n\n# (2) 박스플롯 — 분포 전체 비교\nax2 = axes[1]\ndf_bm_room_order = df_bm_room_stats['room_type'].tolist()\ndf_bm_room_data  = [df_bm_raw[df_bm_raw['room_type'] == rt]['ttm_revpar'].values\n                    for rt in df_bm_room_order]\n\nbp = ax2.boxplot(\n    df_bm_room_data,\n    labels=[df_bm_ROOM_TYPE_KR[rt] for rt in df_bm_room_order],\n    patch_artist=True,\n    showfliers=False,\n    medianprops=dict(color='#E84545', linewidth=2)\n)\ncolors_bp = ['#4A90D9', '#7EC8E3', '#F4A261', '#ADB5BD']\nfor patch, color in zip(bp['boxes'], colors_bp):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.75)\n\nax2.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n            linewidth=1.8, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax2.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n            linewidth=1.8, label=f'Active+Oper 중위 ₩{df_bm_BASELINE_ACTIVE:,}')\nax2.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax2.set_title('room_type별 RevPAR 분포 (박스플롯)', fontsize=12, fontweight='bold')\nax2.legend(fontsize=8.5)\nax2.grid(axis='y', alpha=0.3, linestyle=':')\n\nplt.suptitle('room_type별 RevPAR 벤치마크 비교', fontsize=14, fontweight='bold', y=1.01)\nplt.tight_layout()\nplt.show()\n\n# ── 수치 요약 ────────────────────────────────────────────────\nprint('room_type별 RevPAR 요약')\nfor _, row in df_bm_room_stats.iterrows():\n    vs_all    = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    vs_active = (row['median'] / df_bm_BASELINE_ACTIVE - 1) * 100\n    print(f\"  {row['room_type_kr']:8s}: 중위 ₩{row['median']:>9,.0f}  \"\n          f\"전체기준선 대비 {vs_all:+.1f}%  \"\n          f\"Active기준선 대비 {vs_active:+.1f}%  \"\n          f\"(n={row['count']:,})\")"
    },
    {
      "cell_type": "markdown",
      "content": "## 3. Superhost vs 일반 호스트 RevPAR 비교\n\n**분석 목적:** Superhost 인증이 RevPAR에 미치는 영향을 정량화하고, 자치구별 Superhost 비율과 RevPAR의 상관관계를 분석합니다.\n\n**해석 방향:**\n- Superhost 프리미엄이 클수록 인증 획득의 수익적 가치 확인\n- 구별 Superhost 비율 vs RevPAR 상관관계 → 밀집 효과 또는 개인 역량 효과 구분"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 3. Superhost vs 일반 호스트 RevPAR 비교\n# ============================================================\n\n# ── 전체 Superhost/일반 RevPAR 통계 ─────────────────────────\ndf_bm_super_overall = (\n    df_bm_raw.groupby('superhost')['ttm_revpar']\n    .agg(median='median', mean='mean', count='count')\n    .reset_index()\n)\ndf_bm_super_overall['label'] = df_bm_super_overall['superhost'].map(\n    {True: 'Superhost', False: '일반 호스트'}\n)\n\n# Superhost 프리미엄 계산\ndf_bm_sh_med   = float(df_bm_super_overall.loc[df_bm_super_overall['superhost'], 'median'].iloc[0])\ndf_bm_reg_med  = float(df_bm_super_overall.loc[~df_bm_super_overall['superhost'], 'median'].iloc[0])\ndf_bm_sh_prem  = (df_bm_sh_med / df_bm_reg_med - 1) * 100\n\n# ── 자치구별 Superhost 비율 & RevPAR ─────────────────────────\ndf_bm_district_sh = (\n    df_bm_raw.groupby('district_kr')\n    .agg(\n        superhost_ratio=('superhost', 'mean'),\n        median_revpar=('ttm_revpar', 'median'),\n        count=('ttm_revpar', 'count')\n    )\n    .reset_index()\n)\n\n# ── 시각화: 2×2 서브플롯 ─────────────────────────────────────\nfig, axes = plt.subplots(1, 2, figsize=(14, 7))\n\n# (1) 전체 비교 막대 + 기준선\nax = axes[0]\nlabels = df_bm_super_overall['label'].tolist()\nmedians = df_bm_super_overall['median'].tolist()\nbars = ax.bar(labels, medians,\n              color=['#E84545', '#ADB5BD'],\n              edgecolor='white', width=0.5)\n\nax.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n           linewidth=1.8, label=f'전체 중위 기준선 ₩{df_bm_BASELINE_ALL:,}')\nax.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n           linewidth=1.8, label=f'Active+Oper 기준선 ₩{df_bm_BASELINE_ACTIVE:,}')\n\nfor bar, val in zip(bars, medians):\n    ax.text(bar.get_x() + bar.get_width()/2, val + 200,\n            f'₩{val:,.0f}', ha='center', va='bottom', fontsize=11, fontweight='bold')\n\n# 프리미엄 화살표 표시\nax.annotate(\n    f'Superhost 프리미엄\\n+{df_bm_sh_prem:.1f}%',\n    xy=(0.5, (df_bm_sh_med + df_bm_reg_med) / 2),\n    xytext=(0.95, (df_bm_sh_med + df_bm_reg_med) / 2),\n    fontsize=10, color='#E84545', fontweight='bold',\n    arrowprops=dict(arrowstyle='<->', color='#E84545', lw=1.5)\n)\n\nax.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax.set_title('Superhost vs 일반 호스트 중위 RevPAR', fontsize=12, fontweight='bold')\nax.legend(fontsize=9)\nax.grid(axis='y', alpha=0.3, linestyle=':')\n\n# (2) 산점도: 자치구별 Superhost 비율 vs 중위 RevPAR\nax2 = axes[1]\nscatter = ax2.scatter(\n    df_bm_district_sh['superhost_ratio'] * 100,\n    df_bm_district_sh['median_revpar'],\n    s=df_bm_district_sh['count'] / 10,   # 리스팅 수에 비례하는 크기\n    c=df_bm_district_sh['median_revpar'],\n    cmap='RdYlGn',\n    alpha=0.8,\n    edgecolors='grey',\n    linewidths=0.5\n)\n\n# 각 구 레이블\nfor _, row in df_bm_district_sh.iterrows():\n    ax2.annotate(\n        row['district_kr'],\n        (row['superhost_ratio'] * 100, row['median_revpar']),\n        fontsize=7.5, textcoords='offset points', xytext=(3, 3)\n    )\n\n# 추세선 (선형 회귀)\nfrom numpy.polynomial.polynomial import polyfit as npfit\ndf_bm_x = df_bm_district_sh['superhost_ratio'].values * 100\ndf_bm_y = df_bm_district_sh['median_revpar'].values\ndf_bm_coef = np.polyfit(df_bm_x, df_bm_y, 1)\ndf_bm_trend_x = np.linspace(df_bm_x.min(), df_bm_x.max(), 100)\nax2.plot(df_bm_trend_x, np.polyval(df_bm_coef, df_bm_trend_x),\n         color='#333333', linestyle=':', linewidth=1.5, label='선형 추세선')\n\n# 상관계수 표시\ndf_bm_corr = np.corrcoef(df_bm_x, df_bm_y)[0, 1]\nax2.text(0.05, 0.92, f'Pearson r = {df_bm_corr:.3f}',\n         transform=ax2.transAxes, fontsize=10,\n         bbox=dict(boxstyle='round,pad=0.3', facecolor='lightyellow', alpha=0.8))\n\nax2.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n            linewidth=1.5, label=f'전체 기준선 ₩{df_bm_BASELINE_ALL:,}')\nax2.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax2.set_xlabel('Superhost 비율 (%)', fontsize=11)\nax2.set_ylabel('중위 RevPAR (₩)', fontsize=11)\nax2.set_title('자치구별 Superhost 비율 vs 중위 RevPAR', fontsize=12, fontweight='bold')\nax2.legend(fontsize=9)\nax2.grid(alpha=0.3, linestyle=':')\nplt.colorbar(scatter, ax=ax2, label='중위 RevPAR (₩)')\n\nplt.suptitle('Superhost 성과 벤치마킹', fontsize=14, fontweight='bold', y=1.01)\nplt.tight_layout()\nplt.show()\n\n# ── 수치 출력 ────────────────────────────────────────────────\nprint(f'Superhost 중위 RevPAR  : ₩{df_bm_sh_med:,.0f}')\nprint(f'일반 호스트 중위 RevPAR : ₩{df_bm_reg_med:,.0f}')\nprint(f'Superhost 프리미엄     : +{df_bm_sh_prem:.1f}%')\nprint(f'자치구 Superhost비율-RevPAR 상관계수: r = {df_bm_corr:.3f}')"
    },
    {
      "cell_type": "markdown",
      "content": "## 4. POI 거리 구간별 RevPAR 비교\n\n**분석 목적:** 최인근 POI(관광지 등)까지의 거리 구간별로 RevPAR를 비교하여, 입지(접근성)가 수익성에 미치는 영향을 정량화합니다.\n\n**거리 구간 정의:**\n- 근거리: 0 ~ 0.5 km\n- 중거리: 0.5 ~ 1.0 km\n- 원거리: 1.0 km 이상\n\n**해석 방향:** 거리가 가까울수록 RevPAR가 높으면 입지 프리미엄 존재를 시사합니다."
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 4. POI 거리 구간별 RevPAR 비교\n# ============================================================\n\n# ── POI 거리 구간 생성 ────────────────────────────────────────\ndf_bm_poi = df_bm_raw.copy()\ndf_bm_poi['poi_dist_band'] = pd.cut(\n    df_bm_poi['nearest_poi_dist_km'],\n    bins=[0, 0.5, 1.0, float('inf')],\n    labels=['근거리 (0~0.5km)', '중거리 (0.5~1.0km)', '원거리 (1.0km+)'],\n    right=True\n)\n\n# ── 구간별 RevPAR 집계 ──────────────────────────────────────\ndf_bm_poi_stats = (\n    df_bm_poi.groupby('poi_dist_band', observed=True)['ttm_revpar']\n    .agg(median='median', mean='mean',\n         q25=lambda x: x.quantile(0.25),\n         q75=lambda x: x.quantile(0.75),\n         count='count')\n    .reset_index()\n)\n\n# ── 구간별 × 자치구별 교차 집계 (히트맵용) ───────────────────\ndf_bm_poi_district = (\n    df_bm_poi.groupby(['district_kr', 'poi_dist_band'], observed=True)['ttm_revpar']\n    .median()\n    .reset_index()\n    .pivot(index='district_kr', columns='poi_dist_band', values='ttm_revpar')\n)\n\n# ── 시각화: 1×2 서브플롯 ─────────────────────────────────────\nfig, axes = plt.subplots(1, 2, figsize=(14, 7))\n\n# (1) 구간별 중위/평균 막대 + 기준선\nax = axes[0]\ndf_bm_bands = df_bm_poi_stats['poi_dist_band'].astype(str).tolist()\nx = np.arange(len(df_bm_bands))\nwidth = 0.35\n\nbars_med = ax.bar(x - width/2, df_bm_poi_stats['median'],\n                  width, label='중위값', color='#4A90D9', alpha=0.85)\nbars_avg = ax.bar(x + width/2, df_bm_poi_stats['mean'],\n                  width, label='평균값', color='#F4A261', alpha=0.85)\n\nax.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n           linewidth=1.8, label=f'전체 중위 기준선 ₩{df_bm_BASELINE_ALL:,}')\nax.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n           linewidth=1.8, label=f'Active+Oper 기준선 ₩{df_bm_BASELINE_ACTIVE:,}')\n\nfor bar in bars_med:\n    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 200,\n            f'₩{bar.get_height():,.0f}', ha='center', va='bottom', fontsize=9)\nfor bar in bars_avg:\n    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 200,\n            f'₩{bar.get_height():,.0f}', ha='center', va='bottom', fontsize=9)\n\nax.set_xticks(x)\nax.set_xticklabels(df_bm_bands, fontsize=10)\nax.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax.set_title('POI 거리 구간별 RevPAR vs 기준선', fontsize=12, fontweight='bold')\nax.legend(fontsize=8.5)\nax.grid(axis='y', alpha=0.3, linestyle=':')\n\n# 리스팅 수 표시\nfor i, row in df_bm_poi_stats.iterrows():\n    ax.text(i, -2500, f'n={row[\"count\"]:,}', ha='center', fontsize=8, color='gray')\n\n# (2) 박스플롯 — 분포 비교\nax2 = axes[1]\ndf_bm_poi_data = [\n    df_bm_poi[df_bm_poi['poi_dist_band'] == band]['ttm_revpar'].values\n    for band in df_bm_poi_stats['poi_dist_band']\n]\nbp2 = ax2.boxplot(\n    df_bm_poi_data,\n    labels=df_bm_bands,\n    patch_artist=True,\n    showfliers=False,\n    medianprops=dict(color='#E84545', linewidth=2)\n)\nfor patch, color in zip(bp2['boxes'], ['#4A90D9', '#7EC8E3', '#ADB5BD']):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.7)\n\nax2.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n            linewidth=1.8, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax2.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n            linewidth=1.8, label=f'Active+Oper 중위 ₩{df_bm_BASELINE_ACTIVE:,}')\nax2.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax2.set_title('POI 거리 구간별 RevPAR 분포', fontsize=12, fontweight='bold')\nax2.legend(fontsize=8.5)\nax2.grid(axis='y', alpha=0.3, linestyle=':')\n\nplt.suptitle('POI 접근성별 RevPAR 벤치마킹', fontsize=14, fontweight='bold', y=1.01)\nplt.tight_layout()\nplt.show()\n\n# ── 수치 출력 ────────────────────────────────────────────────\nprint('POI 거리 구간별 RevPAR 요약')\nfor _, row in df_bm_poi_stats.iterrows():\n    vs_base = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"  {str(row['poi_dist_band']):22s}: 중위 ₩{row['median']:>9,.0f}  \"\n          f\"전체기준선 대비 {vs_base:+.1f}%  (n={row['count']:,})\")"
    },
    {
      "cell_type": "markdown",
      "content": "## 5. 점유율 구간별 RevPAR 분포\n\n**분석 목적:** TTM 점유율(ttm_occupancy)을 5개 구간으로 나누어 각 구간에서의 RevPAR 분포를 분석합니다. 점유율과 RevPAR의 관계를 통해 수익 최적화의 핵심 레버를 식별합니다.\n\n**해석 방향:**\n- 높은 점유율 구간에서도 RevPAR가 낮으면 단가(ADR) 전략 개선 필요\n- 낮은 점유율이지만 RevPAR가 높은 구간 → 고가 전략의 성립 여부 확인"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 5. 점유율 구간별 RevPAR 분포\n# ============================================================\n\n# ── 점유율 5구간 생성 (분위 기반) ───────────────────────────\ndf_bm_occ = df_bm_raw.copy()\ndf_bm_occ['occ_quintile'] = pd.qcut(\n    df_bm_occ['ttm_occupancy'],\n    q=5,\n    duplicates='drop'   # 0 값 중복 처리\n)\n\n# 구간 레이블 재가공 (가독성)\ndf_bm_occ['occ_band'] = pd.qcut(\n    df_bm_occ['ttm_occupancy'],\n    q=5,\n    labels=False,\n    duplicates='drop'\n)\n# 실제 분위 경계 파악\ndf_bm_quintile_bounds = df_bm_occ.groupby('occ_band')['ttm_occupancy'].agg(['min', 'max']).reset_index()\ndf_bm_band_labels = [\n    f'Q{int(row[\"occ_band\"])+1} ({row[\"min\"]:.0%}~{row[\"max\"]:.0%})'\n    for _, row in df_bm_quintile_bounds.iterrows()\n]\ndf_bm_label_map = dict(zip(df_bm_quintile_bounds['occ_band'], df_bm_band_labels))\ndf_bm_occ['occ_label'] = df_bm_occ['occ_band'].map(df_bm_label_map)\n\n# ── 구간별 RevPAR 집계 ──────────────────────────────────────\ndf_bm_occ_stats = (\n    df_bm_occ.groupby('occ_label', sort=False)['ttm_revpar']\n    .agg(median='median', mean='mean',\n         q25=lambda x: x.quantile(0.25),\n         q75=lambda x: x.quantile(0.75),\n         count='count')\n    .reset_index()\n)\n# 정렬: Q1 → Q5 순서\ndf_bm_occ_stats['sort_key'] = df_bm_occ_stats['occ_label'].str.extract(r'Q(\\d)').astype(int)\ndf_bm_occ_stats = df_bm_occ_stats.sort_values('sort_key')\n\n# ── 시각화: 2×2 서브플롯 ─────────────────────────────────────\nfig, axes = plt.subplots(2, 2, figsize=(14, 8))\n\n# (1) 중위 RevPAR 막대 + 기준선 (좌상)\nax = axes[0][0]\ncolor_gradient = ['#D0E8FF', '#7EC8E3', '#4A90D9', '#2563AB', '#1E3A5F']\nbars = ax.bar(\n    df_bm_occ_stats['occ_label'],\n    df_bm_occ_stats['median'],\n    color=color_gradient[:len(df_bm_occ_stats)],\n    edgecolor='white'\n)\nax.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n           linewidth=1.8, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax.axhline(df_bm_BASELINE_ACTIVE, color='#E91E63', linestyle='-.',\n           linewidth=1.8, label=f'Active+Oper 중위 ₩{df_bm_BASELINE_ACTIVE:,}')\nfor bar, val in zip(bars, df_bm_occ_stats['median']):\n    ax.text(bar.get_x() + bar.get_width()/2, val + 200,\n            f'₩{val:,.0f}', ha='center', va='bottom', fontsize=8)\nax.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax.set_xticklabels(df_bm_occ_stats['occ_label'], fontsize=8, rotation=15)\nax.set_title('점유율 구간별 중위 RevPAR', fontsize=11, fontweight='bold')\nax.legend(fontsize=8)\nax.grid(axis='y', alpha=0.3, linestyle=':')\n\n# (2) 박스플롯 (우상)\nax2 = axes[0][1]\ndf_bm_occ_data_list = [\n    df_bm_occ[df_bm_occ['occ_label'] == lbl]['ttm_revpar'].values\n    for lbl in df_bm_occ_stats['occ_label']\n]\nbp = ax2.boxplot(\n    df_bm_occ_data_list,\n    labels=df_bm_occ_stats['occ_label'].tolist(),\n    patch_artist=True,\n    showfliers=False,\n    medianprops=dict(color='#E84545', linewidth=2)\n)\nfor patch, color in zip(bp['boxes'], color_gradient[:len(df_bm_occ_stats)]):\n    patch.set_facecolor(color)\n    patch.set_alpha(0.8)\nax2.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n            linewidth=1.8, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax2.set_xticklabels(df_bm_occ_stats['occ_label'], fontsize=8, rotation=15)\nax2.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax2.set_title('점유율 구간별 RevPAR 분포 (박스플롯)', fontsize=11, fontweight='bold')\nax2.legend(fontsize=8)\nax2.grid(axis='y', alpha=0.3, linestyle=':')\n\n# (3) 점유율 vs RevPAR 산점도 (좌하) — 샘플 5,000건\nax3 = axes[1][0]\ndf_bm_sample = df_bm_raw.sample(min(5000, len(df_bm_raw)), random_state=42)\nsc = ax3.scatter(\n    df_bm_sample['ttm_occupancy'] * 100,\n    df_bm_sample['ttm_revpar'],\n    c=df_bm_sample['ttm_revpar'],\n    cmap='YlOrRd',\n    alpha=0.4,\n    s=10\n)\nax3.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n            linewidth=1.5, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax3.set_xlabel('TTM 점유율 (%)', fontsize=10)\nax3.set_ylabel('TTM RevPAR (₩)', fontsize=10)\nax3.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax3.set_title('점유율 vs RevPAR 산점도 (샘플 5,000)', fontsize=11, fontweight='bold')\nax3.legend(fontsize=8)\nax3.grid(alpha=0.3, linestyle=':')\nplt.colorbar(sc, ax=ax3, label='RevPAR (₩)')\n\n# (4) 구간별 리스팅 수 & 평균 RevPAR (우하)\nax4 = axes[1][1]\nax4_twin = ax4.twinx()\nbars4 = ax4.bar(\n    df_bm_occ_stats['occ_label'],\n    df_bm_occ_stats['count'],\n    color='#ADB5BD',\n    alpha=0.6,\n    label='리스팅 수 (좌축)'\n)\nline4, = ax4_twin.plot(\n    df_bm_occ_stats['occ_label'],\n    df_bm_occ_stats['mean'],\n    color='#E84545',\n    marker='o',\n    linewidth=2,\n    markersize=7,\n    label='평균 RevPAR (우축)'\n)\nax4_twin.axhline(df_bm_BASELINE_ALL, color='#2196F3', linestyle='--',\n                 linewidth=1.5, label=f'전체 중위 ₩{df_bm_BASELINE_ALL:,}')\nax4.set_xticklabels(df_bm_occ_stats['occ_label'], fontsize=8, rotation=15)\nax4.set_ylabel('리스팅 수', fontsize=10)\nax4_twin.set_ylabel('평균 RevPAR (₩)', fontsize=10)\nax4_twin.yaxis.set_major_formatter(mticker.FuncFormatter(lambda y, _: f'₩{y:,.0f}'))\nax4.set_title('점유율 구간별 리스팅 수 & 평균 RevPAR', fontsize=11, fontweight='bold')\nlines4 = [bars4, line4]\nlabels4 = ['리스팅 수', '평균 RevPAR']\nax4.legend(lines4, labels4, fontsize=8, loc='upper left')\nax4.grid(axis='y', alpha=0.3, linestyle=':')\n\nplt.suptitle('점유율 구간별 RevPAR 벤치마킹', fontsize=14, fontweight='bold')\nplt.tight_layout()\nplt.show()\n\n# ── 수치 출력 ────────────────────────────────────────────────\nprint('점유율 구간별 RevPAR 요약')\nfor _, row in df_bm_occ_stats.iterrows():\n    vs_base = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"  {row['occ_label']:30s}: 중위 ₩{row['median']:>9,.0f}  \"\n          f\"평균 ₩{row['mean']:>9,.0f}  \"\n          f\"전체기준선 대비 {vs_base:+.1f}%  (n={row['count']:,})\")"
    },
    {
      "cell_type": "markdown",
      "content": "## 6. 종합 벤치마크 대시보드 — 자치구 × 호스트 유형 매트릭스\n\n**분석 목적:** 자치구와 room_type을 교차 분석하여, 어떤 구에서 어떤 유형의 숙소가 가장 높은 RevPAR를 기록하는지를 히트맵으로 시각화합니다.\n\n**활용 방안:** 투자 또는 운영 지역·유형 선택 시 데이터 기반 의사결정 참고 자료로 활용"
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 6. 종합 벤치마크 대시보드 — 자치구 × room_type 히트맵\n# ============================================================\nimport matplotlib.colors as mcolors\n\n# ── 교차 집계: 자치구 × room_type 중위 RevPAR ────────────────\ndf_bm_pivot = (\n    df_bm_raw.groupby(['district_kr', 'room_type'])['ttm_revpar']\n    .median()\n    .reset_index()\n    .pivot(index='district_kr', columns='room_type', values='ttm_revpar')\n)\n\n# 자치구를 entire_home 중위값 기준으로 정렬 (상위 → 하위)\ndf_bm_pivot = df_bm_pivot.sort_values('entire_home', ascending=False)\n\n# room_type 컬럼 한글 변환\ndf_bm_pivot.columns = [df_bm_ROOM_TYPE_KR.get(c, c) for c in df_bm_pivot.columns]\n\n# ── 히트맵 시각화 ────────────────────────────────────────────\nfig, ax = plt.subplots(figsize=(12, 10))\n\nim = ax.imshow(\n    df_bm_pivot.fillna(0).values,\n    cmap='RdYlGn',\n    aspect='auto'\n)\n\n# 축 레이블\nax.set_xticks(range(len(df_bm_pivot.columns)))\nax.set_xticklabels(df_bm_pivot.columns, fontsize=11, fontweight='bold')\nax.set_yticks(range(len(df_bm_pivot.index)))\nax.set_yticklabels(df_bm_pivot.index, fontsize=10)\n\n# 셀 내부 수치 표시\nfor i, row_name in enumerate(df_bm_pivot.index):\n    for j, col_name in enumerate(df_bm_pivot.columns):\n        val = df_bm_pivot.loc[row_name, col_name]\n        if pd.notna(val) and val > 0:\n            # 배경 밝기에 따라 글자색 결정\n            norm_val = val / df_bm_pivot.values[~np.isnan(df_bm_pivot.values)].max()\n            text_color = 'white' if norm_val > 0.6 else 'black'\n            ax.text(j, i, f'₩{val:,.0f}',\n                    ha='center', va='center',\n                    fontsize=7.5, color=text_color, fontweight='bold')\n        elif pd.isna(val) or val == 0:\n            ax.text(j, i, 'N/A', ha='center', va='center', fontsize=8, color='gray')\n\n# 기준선 수치를 컬러바 영역에 표시\nplt.colorbar(im, ax=ax, label='중위 TTM RevPAR (₩)', fraction=0.03, pad=0.02)\n\nax.set_title(\n    f'자치구 × room_type 중위 RevPAR 히트맵\\n'\n    f'(전체 기준선 ₩{df_bm_BASELINE_ALL:,} / Active+Oper 기준선 ₩{df_bm_BASELINE_ACTIVE:,})',\n    fontsize=13, fontweight='bold', pad=12\n)\nax.set_xlabel('숙소 유형', fontsize=11)\nax.set_ylabel('자치구 (entire_home 중위값 기준 정렬)', fontsize=11)\n\nplt.tight_layout()\nplt.show()\n\n# ── 전체 기준선 대비 초과/미달 요약 ─────────────────────────\nprint(f'[전체 기준선 ₩{df_bm_BASELINE_ALL:,} 초과 셀 수]')\ndf_bm_above = (df_bm_pivot > df_bm_BASELINE_ALL).sum()\nprint(df_bm_above.to_string())\n\nprint(f'\\n[Active+Oper 기준선 ₩{df_bm_BASELINE_ACTIVE:,} 초과 셀 수]')\ndf_bm_above_active = (df_bm_pivot > df_bm_BASELINE_ACTIVE).sum()\nprint(df_bm_above_active.to_string())"
    },
    {
      "cell_type": "markdown",
      "content": "## 7. 벤치마크 종합 인사이트 요약\n\n**분석 목적:** 앞서 수행한 5가지 벤치마크 비교 결과를 종합하여 핵심 시사점을 수치 기반으로 정리합니다."
    },
    {
      "cell_type": "code",
      "content": "# ============================================================\n# 7. 벤치마크 종합 인사이트 요약\n# ============================================================\n\nprint('=' * 65)\nprint('  서울 에어비앤비 RevPAR 벤치마크 종합 인사이트')\nprint('=' * 65)\n\n# ── 기준선 현황 ──────────────────────────────────────────────\nprint('\\n[기준선 현황]')\nprint(f'  전체 중위 RevPAR (업계 벤치마크) : ₩{df_bm_BASELINE_ALL:>10,}')\nprint(f'  전체 중위 RevPAR (실제 데이터)   : ₩{df_bm_median_all:>10,.0f}')\nprint(f'  Active+Oper 중위 (업계 벤치마크) : ₩{df_bm_BASELINE_ACTIVE:>10,}')\nprint(f'  Active+Oper 중위 (실제 데이터)   : ₩{df_bm_median_active:>10,.0f}')\n\n# ── 자치구 벤치마크 요약 ─────────────────────────────────────\nprint('\\n[자치구별 RevPAR 벤치마크]')\ndf_bm_top3_dist = df_bm_district_revpar.sort_values('median', ascending=False).head(3)\ndf_bm_bot3_dist = df_bm_district_revpar.sort_values('median', ascending=True).head(3)\nprint('  상위 3개 자치구:')\nfor _, row in df_bm_top3_dist.iterrows():\n    pct = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"    {row['district_kr']:6s}: ₩{row['median']:>9,.0f}  (기준선 대비 +{pct:.0f}%)\")\nprint('  하위 3개 자치구:')\nfor _, row in df_bm_bot3_dist.iterrows():\n    pct = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"    {row['district_kr']:6s}: ₩{row['median']:>9,.0f}  (기준선 대비 {pct:+.0f}%)\")\n\n# ── room_type 벤치마크 요약 ──────────────────────────────────\nprint('\\n[room_type별 RevPAR 벤치마크]')\nfor _, row in df_bm_room_stats.iterrows():\n    pct = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"  {row['room_type_kr']:8s}: ₩{row['median']:>9,.0f}  (기준선 대비 {pct:+.0f}%)\")\n\n# ── Superhost 프리미엄 ────────────────────────────────────────\nprint('\\n[Superhost 성과 벤치마크]')\nprint(f'  Superhost 중위 RevPAR  : ₩{df_bm_sh_med:>9,.0f}')\nprint(f'  일반 호스트 중위 RevPAR : ₩{df_bm_reg_med:>9,.0f}')\nprint(f'  Superhost 프리미엄     : {df_bm_sh_prem:+.1f}%')\nprint(f'  구별 Superhost비율-RevPAR 상관: r = {df_bm_corr:.3f}')\n\n# ── POI 거리 벤치마크 요약 ──────────────────────────────────\nprint('\\n[POI 거리 구간별 RevPAR 벤치마크]')\nfor _, row in df_bm_poi_stats.iterrows():\n    pct = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"  {str(row['poi_dist_band']):22s}: ₩{row['median']:>9,.0f}  (기준선 대비 {pct:+.0f}%)  n={row['count']:,}\")\n\n# ── 점유율 구간 RevPAR 요약 ──────────────────────────────────\nprint('\\n[점유율 구간별 RevPAR 벤치마크]')\nfor _, row in df_bm_occ_stats.iterrows():\n    pct = (row['median'] / df_bm_BASELINE_ALL - 1) * 100\n    print(f\"  {row['occ_label']:30s}: ₩{row['median']:>9,.0f}  (기준선 대비 {pct:+.0f}%)\")\n\nprint('\\n' + '=' * 65)\nprint('  분석 완료')\nprint('=' * 65)"
    }
  ]
}
